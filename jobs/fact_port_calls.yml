version: 1
job:
  type: "processing"
  tags:
  - "epsdl_fact"
source:
  endpoint: "lo_delta_tables"
  properties:
    sql: "select \nexpected_call_da.vessel_code,\nexpected_call_da.eta,\nexpected_call_da.port_name,\nexpected_call_da.declared_y_n,\nexpected_call_da.owners_agents_code,\nexpected_call_da.contact,\nexpected_call_da.contact_tel_aoh,\nexpected_call_da.charterers_agents_code,\nexpected_call_da.contact_c_a,\nexpected_call_da.contact_tel_aoh_c_a,\nexpected_call_da.subagent,\nexpected_call_da.contact_subagent,\nexpected_call_da.contact_subagent_tel_aoh,\nexpected_call_da.port_action,\nexpected_call_da.etd,\nexpected_call_da.general_comments,\nexpected_call_da.operation_actions,\nexpected_call_da.technical_actions,\nexpected_call_da.port_capt_manning_actions,\nexpected_call_da.insurance_actions,\nexpected_call_da.other_actions,\nexpected_call_da.created_on,\nexpected_call_da.creator,\nexpected_call_da.last_updated,\nexpected_call_da.updated_by,\nexpected_call_da.notice1_days,\nexpected_call_da.notice2_days,\nexpected_call_da.notice3_days,\nexpected_call_da.notice4_days,\nexpected_call_da.notice5_days,\nexpected_call_da.notice6_days,\nexpected_call_da.notice7_days,\nexpected_call_da.notice8_days,\nexpected_call_da.notice9_days,\nexpected_call_da.notice1_ok,\nexpected_call_da.notice2_ok,\nexpected_call_da.notice3_ok,\nexpected_call_da.notice4_ok,\nexpected_call_da.notice5_ok,\nexpected_call_da.notice6_ok,\nexpected_call_da.notice7_ok,\nexpected_call_da.notice8_ok,\nexpected_call_da.notice9_ok,\nexpected_call_da.owners_agents_tel,\nexpected_call_da.owners_agents_fax,\nexpected_call_da.owners_agents_tlx,\nexpected_call_da.contact_mob_tel,\nexpected_call_da.reference,\nexpected_call_da.exp_ref,\nexpected_call_da.voy_id,\nexpected_call_da.sub_voy_no,\nexpected_call_da.freight_tax,\nexpected_call_da.via_cost,\nexpected_call_da.insurance_cost,\nexpected_call_da.est_days,\nexpected_call_da.est_rate,\nexpected_call_da.canal_expenses,\nexpected_call_da.extra_days,\nexpected_call_da.rate_close,\nexpected_call_da.rate_unit,\nexpected_call_da.l_d_rate,\nexpected_call_da.cargo_unit,\nexpected_call_da.cargo_qty,\nexpected_call_da.delays,\nexpected_call_da.vsl_sea_days,\nexpected_call_da.fo_cons_delays,\nexpected_call_da.do_cons_delays,\nexpected_call_da.vsl_next_port,\nexpected_call_da.vsl_eta_next_port,\nexpected_call_da.vsl_eta_next_port_loc,\nexpected_call_da.prev_exp_ref,\nexpected_call_da.next_exp_ref,\nexpected_call_da.created_on_date,\nexpected_call_da.voy_series,\nexpected_call_da.berth,\nexpected_call_da.arrival_fo,\nexpected_call_da.arrival_do,\nexpected_call_da.arrival_go,\nexpected_call_da.departure_fo,\nexpected_call_da.departure_do,\nexpected_call_da.departure_go,\nexpected_call_da.etb_local,\nexpected_call_da.call_status,\nexpected_call_da.port_days,\nexpected_call_da.is_cancelled,\nexpected_call_da.via_canal,\nexpected_call_da.speed,\nexpected_call_da.vessel_speed,\nexpected_call_da.miles,\nexpected_call_da.miles_c,\nexpected_call_da.miles_mod,\nexpected_call_da.b_l,\nexpected_call_da.eta_local,\nexpected_call_da.vessel_eta,\nexpected_call_da.vessel_eta_local,\nexpected_call_da.etd_local,\nexpected_call_da.vessel_etd,\nexpected_call_da.vessel_etd_local,\nexpected_call_da.etb,\nexpected_call_da.etb_lock,\nexpected_call_da.laydays,\nexpected_call_da.cancelling,\nexpected_call_da.laydays_local,\nexpected_call_da.cancelling_local,\nexpected_call_da.dc,\nexpected_call_da.wait_port_days,\nexpected_call_da.idle_port_days,\nexpected_call_da.extra_port_days,\nexpected_call_da.offhire_port_days,\nexpected_call_da.sea_days,\nexpected_call_da.extra_sea_days,\nexpected_call_da.stem_ifo,\nexpected_call_da.stem_mdo,\nexpected_call_da.stem_go,\nexpected_call_da.supplied_ifo,\nexpected_call_da.supplied_mdo,\nexpected_call_da.supplied_go,\nexpected_call_da.vsl_arrival_fo,\nexpected_call_da.vsl_arrival_do,\nexpected_call_da.vsl_arrival_go,\nexpected_call_da.vsl_departure_fo,\nexpected_call_da.vsl_departure_do,\nexpected_call_da.vsl_departure_go,\nexpected_call_da.fo_cons_ballast,\nexpected_call_da.do_cons_ballast,\nexpected_call_da.fo_cons_laden,\nexpected_call_da.do_cons_laden,\nexpected_call_da.fo_cons_cargo,\nexpected_call_da.do_cons_cargo,\nexpected_call_da.fo_cons_idle,\nexpected_call_da.do_cons_idle,\nexpected_call_da.gear_working_flag,\nexpected_call_da.port_expenses,\nexpected_call_da.c_agents_tel,\nexpected_call_da.c_agents_fax,\nexpected_call_da.c_agents_tlx,\nexpected_call_da.c_agents_contact_mob_tel,\nexpected_call_da.subagent_tel,\nexpected_call_da.subagent_fax,\nexpected_call_da.subagent_tlx,\nexpected_call_da.subagent_contact_mob_tel,\nexpected_call_da.marine_actions,\nexpected_call_da.crewing_actions,\nexpected_call_da.accounting_actions,\nexpected_call_da.supplies_actions,\nexpected_call_da.agent_relation,\nexpected_call_da.remarks,\nexpected_call_da.publish_to_vpr,\nexpected_call_da.claims_notes_date,\nexpected_call_da.claims_notes_user_id,\nexpected_call_da.leg_speed,\nexpected_call_da.slops_rob_unit,\nexpected_call_da.crew_changes,\nexpected_call_da.laycan_date_local,\nexpected_call_da.cancel_date_local,\nexpected_call_da.stem_date,\nexpected_call_da.stem_supplier,\nexpected_call_da.stem_suplier_aoh_tel,\nexpected_call_da.stem_broker,\nexpected_call_da.stem_broker_aoh_tel,\nexpected_call_da.supplied_date,\nexpected_call_da.invoice_date,\nexpected_call_da.invoice_no,\nexpected_call_da.cargo_type,\nexpected_call_da.arrival_flag,\nexpected_call_da.terminal,\nexpected_call_da.cargo_grade,\nexpected_call_da.action_type,\nexpected_call_da.pob,\nexpected_call_da.anchor_arr,\nexpected_call_da.anchor_dep,\nexpected_call_da.unberthed,\nexpected_call_da.ref_id,\nexpected_call_da.invoiced_ifo,\nexpected_call_da.invoiced_mdo,\nexpected_call_da.invoiced_go,\nexpected_call_da.commission_rate,\nexpected_call_da.est_port_days,\nexpected_call_da.subvoy_no,\nexpected_call_da.seq_no,\nexpected_call_da.cargo_no,\nexpected_call_da.options_prc,\nexpected_call_da.stowage_factor,\nexpected_call_da.lift,\nexpected_call_da.max_draft,\nexpected_call_da.salinity,\nexpected_call_da.shipper,\nexpected_call_da.receiver,\nexpected_call_da.fo_cons_gear,\nexpected_call_da.do_cons_gear,\nexpected_call_da.fo_cons_not_gear,\nexpected_call_da.do_cons_not_gear,\nexpected_call_da.est_rate_unit,\nexpected_call_da.est_rate_close,\nexpected_call_da.est_extra_days,\nexpected_call_da.demurrage_rate,\nexpected_call_da.dispatch_rate,\nexpected_call_da.fo_price,\nexpected_call_da.do_price,\nexpected_call_da.go_price,\nexpected_call_da.order_code,\nexpected_call_da.arrival_date,\nexpected_call_da.departure_date,\nexpected_call_da.berthed,\nexpected_call_da.nor,\nexpected_call_da.co_in_storage,\nexpected_call_da.so_in_storage,\nexpected_call_da.go_in_storage,\nexpected_call_da.co_in_storage_dep,\nexpected_call_da.so_in_storage_dep,\nexpected_call_da.go_in_storage_dep,\nexpected_call_da.bp_distinroute,\nexpected_call_da.bp_route,\nexpected_call_da.fo_price_local,\nexpected_call_da.do_price_local,\nexpected_call_da.fo_do_currency_local,\nexpected_call_da.first_port_for_period,\nexpected_call_da.period_no,\nexpected_call_da.prev_voy_id,\nexpected_call_da.bp_routingsettings,\nexpected_call_da.dist_origin,\nexpected_call_da.psc_inspection_requested,\nexpected_call_da.port_modified_sap,\nexpected_call_da.port_modified_afsys,\nexpected_call_da.vsl_arrival_hsfo,\nexpected_call_da.vsl_arrival_lsfo,\nexpected_call_da.vsl_arrival_hsdo,\nexpected_call_da.vsl_arrival_lsdo,\nexpected_call_da.vsl_departure_hsfo,\nexpected_call_da.vsl_departure_lsfo,\nexpected_call_da.arrival_hsdo,\nexpected_call_da.vsl_departure_hsdo,\nexpected_call_da.vsl_departure_lsdo,\nexpected_call_da.arrival_lsfo,\nexpected_call_da.arrival_lsdo,\nexpected_call_da.arrival_hsfo,\nexpected_call_da.departure_hsfo,\nexpected_call_da.departure_lsfo,\nexpected_call_da.departure_hsdo,\nexpected_call_da.departure_lsdo,\nexpected_call_da.lsfo_sea_bss,\nexpected_call_da.lsdo_sea_pct,\nexpected_call_da.lsfo_sea_pct,\nexpected_call_da.lsfo_port_pct,\nexpected_call_da.lsdo_port_pct,\nexpected_call_da.lsdo_sea_bss,\nexpected_call_da.lsfo_port_bss,\nexpected_call_da.port_no,\nexpected_call_da.supplied_hsfo,\nexpected_call_da.supplied_lsfo,\nexpected_call_da.supplied_hsdo,\nexpected_call_da.supplied_lsdo,\nexpected_call_da.lsdo_port_bss,\nexpected_call_da.short_charter,\nexpected_call_da.owners_agents_email1,\nexpected_call_da.charterers_agents_email1,\nexpected_call_da.subagents_email1,\nexpected_call_da.surveyors_email1,\nexpected_call_da.owner_agent_appointed,\nexpected_call_da.charterer_agent_appointed,\nexpected_call_da.sub_agent_appointed,\nexpected_call_da.surveyor_contact,\nexpected_call_da.surveyor_contact_tel_aoh,\nexpected_call_da.surveyor_tel,\nexpected_call_da.surveyor_contact_mob_tel,\nexpected_call_da.surveyor_fax,\nexpected_call_da.surveyor_tlx,\nexpected_call_da.surveyor,\nexpected_call_da.port_action_det,\nexpected_call_da.commence_date,\nexpected_call_da.commence_date_local,\nexpected_call_da.complete_date,\nexpected_call_da.complete_date_local,\nexpected_call_da.draft_arr_f,\nexpected_call_da.draft_arr_a,\nexpected_call_da.draft_arr_m,\nexpected_call_da.draft_dep_f,\nexpected_call_da.draft_dep_a,\nexpected_call_da.draft_dep_m,\nexpected_call_da.vsl_arrival_water,\nexpected_call_da.vsl_departure_water,\nexpected_call_da.direction,\nexpected_call_da.area_service,\nexpected_call_da.voy_cycle,\nexpected_call_da.terminal_code,\nexpected_call_da.job_number,\nexpected_call_da.area_service_version,\nexpected_call_da.created_by_services,\nexpected_call_da.in_out,\nexpected_call_da.matched_with_dp_rp,\nexpected_call_da.port_action_det_tz,\nexpected_call_da.owners_agents_code_head,\nexpected_call_da.charterers_agents_code_head,\nexpected_call_da.subagent_head,\nexpected_call_da.surveyor_head,\nexpected_call_da.charterer_agent_comments,\nexpected_call_da.surveyor_crg,\nexpected_call_da.surveyor_contact_crg,\nexpected_call_da.surveyor_contact_tel_aoh_crg,\nexpected_call_da.surveyor_tel_crg,\nexpected_call_da.surveyor_contact_mob_tel_crg,\nexpected_call_da.surveyor_fax_crg,\nexpected_call_da.surveyor_tlx_crg,\nexpected_call_da.surveyor_head_crg,\nexpected_call_da.surveyor_oth,\nexpected_call_da.surveyor_contact_oth,\nexpected_call_da.surveyor_contact_tel_aoh_oth,\nexpected_call_da.surveyor_tel_oth,\nexpected_call_da.surveyor_contact_mob_tel_oth,\nexpected_call_da.surveyor_fax_oth,\nexpected_call_da.surveyor_tlx_oth,\nexpected_call_da.surveyor_head_oth,\nexpected_call_da.surveyors_email1_crg,\nexpected_call_da.surveyors_email1_oth,\nexpected_call_da.show_pos_own_agent,\nexpected_call_da.show_pos_chr_agent,\nexpected_call_da.show_pos_subagent,\nexpected_call_da.ctm_curr,\nexpected_call_da.ctm_local_amount,\nexpected_call_da.ctm_book_amount,\nexpected_call_da.port_name_full,\nexpected_call_da.berthed_gmt,\nexpected_call_da.berthed_local,\nexpected_call_da.unberthed_gmt,\nexpected_call_da.unberthed_local,\nexpected_call_da.virtual_dep,\nexpected_call_da.virtual_arr,\nexpected_call_da.other_head,\nexpected_call_da.other_contact,\nexpected_call_da.other_contact_tel_aoh,\nexpected_call_da.other_tel,\nexpected_call_da.other_contact_mob_tel,\nexpected_call_da.other_fax,\nexpected_call_da.other_tlx,\nexpected_call_da.other_email1,\nexpected_call_da.other_appointed,\nexpected_call_da.other_agent,\nyear(coalesce(expected_call_da.VESSEL_ETA,expected_call_da.ETA)) as port_call_year,\ndim_gl_vessel.vessel_id\nfrom\nepsdlsrid.sri_expected_call expected_call_da\nleft join\nepsdld.dim_gl_vessel dim_gl_vessel\non\ndim_gl_vessel.vessel_code=expected_call_da.vessel_code\nand \ndim_gl_vessel.FLEET_TYPE is not null \nand\ndim_gl_vessel.MANAGED_BY_EPS = 'EPS SG'\nwhere \nsri_expected_call.w_business_dt='${business_date}' "
  additional_columns:
  - name: "w_refresh_ts"
    value: "current_timestamp"
  - name: "business_date"
    value: "'${business_date}'"
  - name: "w_job_instance_id"
    value: "${job_instance_id}"
  - name: "w_batch_id"
    value: "${batch_id}"
  - name: "w_location"
    value: "'ALL'"
  - name: "w_source_system"
    value: "'MANUAL'"
target:
  operation: "merge"
  properties:
    template: "default"
    table: "${p_epsdl_db}.fact_fact_port_calls"
  endpoint: "lo_delta_tables"
