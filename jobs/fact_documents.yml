version: 1
job:
  type: "processing"
  tags:
  - "epsdl_fact"
source:
  endpoint: "lo_delta_tables"
  properties:
    sql: "select\naccrual_type\n,accrued_by_user\n,accrued_by_user_2\n,accrued_on_date\n,allocation_date_from\n,allocation_date_to\n,amount\n,application_code\n,application_ref\n,approval_level\n,approved_by\n,ar_type\n,bank\n,book_credit_off\n,book_debit_off\n,book_value\n,book_value_off\n,book_value2\n,book_value3\n,budget\n,bunker_price\n,bunker_qty\n,created_by_user\n,created_by_user_2\n,currency\n,currency3\n,db_userid\n,debit_credit\n,document_category\n,document_date\n,document_status\n,document_subject\n,document_subsubject\n,document_type\n,due_date\n,entry_number\n,entry_rate\n,entry_rate2\n,entry_rate3\n,filed_to\n,filed_to3\n,finalized_by_user\n,finalized_by_user_2\n,flag1\n,flag2\n,flag3\n,from_to\n,fx_rate\n,import_status\n,imported_by\n,inc_exp_category\n,inc_exp_group\n,instrument_no\n,issue_date\n,job_number\n,journal_company\n,journal_date\n,journal_line\n,journal_number\n,journal_posting\n,journal_series\n,journal_status\n,journal_user\n,journal_user_2\n,last_updated\n,matching_company\n,matching_line\n,matching_number\n,matching_series\n,mc_reference\n,name\n,open_item_status\n,operation_code1\n,operation_code2\n,operation_id1\n,operation_id2\n,operation_subid_1\n,operation_subid_2\n,order_number\n,our_company\n,pay_approval_level\n,pay_flag\n,pay_selected\n,payment_method\n,place\n,prt_flag\n,remarks\n,reporting_amount\n,serial_no\n,set_currency_amount\n,spot_rate_flag\n,sup_match\n,supplier_code\n,team\n,tot_book_credit\n,tot_book_credit2\n,tot_book_credit3\n,tot_book_debit\n,tot_book_debit2\n,tot_book_debit3\n,tot_local_credit\n,tot_local_debit\n,transaction_type\n,vat_amount\n,vat_category\n,vat_number\n,vessel_code\n,withholding_tax_amount\n,withholding_tax_code\n,narrative as journal_narrative\n,narrative\n,JOURNAL_COMPANY || '/' || JOURNAL_SERIES || '/' || JOURNAL_NUMBER as journal_reference\n,integration_key\n,null as w_x_custom\n,w_job_instance_id\n,w_refresh_ts\n,null as w_curr_rec_flg\n,w_source_system as w_data_src_id\n,w_location\n,w_batch_id\n,null as w_partition\n,'${business_date[0..9]}' as business_date\nfrom  ${p_epsdl_sri_db}.sri_documents \nwhere w_business_dt='${business_date[0..9]}'"
  additional_columns:
  - name: "w_refresh_ts"
    value: "current_timestamp"
  - name: "business_date"
    value: "'${business_date}'"
  - name: "w_job_instance_id"
    value: "${job_instance_id}"
  - name: "w_batch_id"
    value: "${batch_id}"
  - name: "w_location"
    value: "'ALL'"
  - name: "w_source_system"
    value: "'NSLADMIN'"
target:
  primary_key_columns:
  - "integration_key"
  operation: "merge"
  properties:
    template: "default"
    table: "${p_epsdl_db}.fact_documents"
  merge_columns:
  - "accrual_type"
  - "accrued_by_user"
  - "accrued_by_user_2"
  - "accrued_on_date"
  - "allocation_date_from"
  - "allocation_date_to"
  - "amount"
  - "application_code"
  - "application_ref"
  - "approval_level"
  - "approved_by"
  - "ar_type"
  - "bank"
  - "book_credit_off"
  - "book_debit_off"
  - "book_value"
  - "book_value_off"
  - "book_value2"
  - "book_value3"
  - "budget"
  - "bunker_price"
  - "bunker_qty"
  - "created_by_user"
  - "created_by_user_2"
  - "currency"
  - "currency3"
  - "db_userid"
  - "debit_credit"
  - "document_category"
  - "document_date"
  - "document_status"
  - "document_subject"
  - "document_subsubject"
  - "document_type"
  - "due_date"
  - "entry_number"
  - "entry_rate"
  - "entry_rate2"
  - "entry_rate3"
  - "filed_to"
  - "filed_to3"
  - "finalized_by_user"
  - "finalized_by_user_2"
  - "flag1"
  - "flag2"
  - "flag3"
  - "from_to"
  - "fx_rate"
  - "import_status"
  - "imported_by"
  - "inc_exp_category"
  - "inc_exp_group"
  - "instrument_no"
  - "issue_date"
  - "job_number"
  - "journal_company"
  - "journal_date"
  - "journal_line"
  - "journal_number"
  - "journal_posting"
  - "journal_series"
  - "journal_status"
  - "journal_user"
  - "journal_user_2"
  - "last_updated"
  - "matching_company"
  - "matching_line"
  - "matching_number"
  - "matching_series"
  - "mc_reference"
  - "name"
  - "open_item_status"
  - "operation_code1"
  - "operation_code2"
  - "operation_id1"
  - "operation_id2"
  - "operation_subid_1"
  - "operation_subid_2"
  - "order_number"
  - "our_company"
  - "pay_approval_level"
  - "pay_flag"
  - "pay_selected"
  - "payment_method"
  - "place"
  - "prt_flag"
  - "remarks"
  - "reporting_amount"
  - "serial_no"
  - "set_currency_amount"
  - "spot_rate_flag"
  - "sup_match"
  - "supplier_code"
  - "team"
  - "tot_book_credit"
  - "tot_book_credit2"
  - "tot_book_credit3"
  - "tot_book_debit"
  - "tot_book_debit2"
  - "tot_book_debit3"
  - "tot_local_credit"
  - "tot_local_debit"
  - "transaction_type"
  - "vat_amount"
  - "vat_category"
  - "vat_number"
  - "vessel_code"
  - "withholding_tax_amount"
  - "withholding_tax_code"
  - "narrative as journal_narrative"
  - "narrative"
  - "journal_reference"
  endpoint: "lo_delta_tables"
