version: 1
job:
  type: "processing"
  tags:
  - "epsdl_dim"
source:
  endpoint: "lo_delta_tables"
  properties:
    sql: "select\nvessel_code\n,department\n,document_code\n,document_no\n,DOCUMENT_DATE as document_date\n,requisition_code\n,quotation_code\n,order_code\n,delivery_code\n,invoice_no\n,delivery_date\n,ships_requisition_no\n,requisition_port\n,order_port\n,delivery_port\n,order_due_date\n,requisition_eta\n,requisition_etd\n,voyage_id\n,voyage_number\n,protected\n,quotation_supplier\n,total_items\n,line_type\n,order_supplier\n,order_agent\n,comments\n,entry_unit_type\n,user\n,approver\n,verifier\n,currency\n,reference\n,additional_items\n,additional_price\n,journal_reference\n,tarriff_agreed\n,part_deliveries\n,user_1\n,user_2\n,user_3\n,user_4\n,tariff_agreed\n,extra_comments\n,total_add_expenses\n,dispatch_vessel_code\n,dispatch_department_code\n,dispatch_line\n,requisition_raised_date\n,dn_code\n,urgency_code\n,invoice_supplier\n,supplier_location\n,period_required\n,terms\n,approver2\n,payment_terms\n,tariff_agreed_date\n,commercial_contract\n,commercial_contract_date\n,supplier_reminder\n,disputed_flag\n,budget_code\n,sent_to\n,warehouse_code\n,warehouse_supplier\n,delivery_to\n,maintenance_link\n,user_5\n,issued_by\n,prepare_direct\n,disputed_date\n,approved_flag\n,approved_date\n,sent_for_approval\n,sent_for_approval_date\n,disputed_comments\n,approved_comments\n,buyer_comments\n,supplier_name\n,accounting_flag\n,created_by_vessel\n,delivery_confirmation_date\n,acc_category_code\n,document_source\n,delivery_confirmation\n,vendor_location\n,acc_process_flag\n,forwarding_instructions\n,print_option\n,date_imported\n,spc_category_code\n,discount\n,exchange_rate_flag\n,previous_exchange_rate\n,order_date\n,accrual_reference\n,requisition_description\n,supplier_reminder_no\n,import_flag\n,quotation_comments\n,integration_key\n,null as w_x_custom\n,w_job_instance_id\n,w_refresh_ts\n,null as w_curr_rec_flg\n,w_source_system as w_data_src_id\n,w_location\n,w_batch_id\n,null as w_partition\n,'${business_date[0..9]}' as business_date\nfrom ${p_epsdl_sri_db}.sri_requisitions\nwhere w_business_dt='${business_date[0..9]}'"
  additional_columns:
  - name: "w_refresh_ts"
    value: "current_timestamp"
  - name: "business_date"
    value: "'${business_date}'"
  - name: "w_job_instance_id"
    value: "${job_instance_id}"
  - name: "w_batch_id"
    value: "${batch_id}"
  - name: "w_location"
    value: "'ALL'"
  - name: "w_source_system"
    value: "'NSLADMIN'"
target:
  primary_key_columns:
  - "integration_key"
  operation: "merge"
  properties:
    template: "default"
    table: "${p_epsdl_db}.dim_requisitions"
  merge_columns:
  - "vessel_code"
  - "department"
  - "document_code"
  - "document_no"
  - "document_date"
  - "requisition_code"
  - "quotation_code"
  - "order_code"
  - "delivery_code"
  - "invoice_no"
  - "delivery_date"
  - "ships_requisition_no"
  - "requisition_port"
  - "order_port"
  - "delivery_port"
  - "order_due_date"
  - "requisition_eta"
  - "requisition_etd"
  - "voyage_id"
  - "voyage_int"
  - "protected"
  - "quotation_supplier"
  - "total_items"
  - "line_type"
  - "order_supplier"
  - "order_agent"
  - "comments"
  - "entry_unit_type"
  - "user"
  - "approver"
  - "verifier"
  - "currency"
  - "reference"
  - "additional_items"
  - "additional_price"
  - "journal_reference"
  - "tarriff_agreed"
  - "part_deliveries"
  - "user_1"
  - "user_2"
  - "user_3"
  - "user_4"
  - "tariff_agreed"
  - "extra_comments"
  - "total_add_expenses"
  - "dispatch_vessel_code"
  - "dispatch_department_code"
  - "dispatch_line"
  - "requisition_raised_date"
  - "dn_code"
  - "urgency_code"
  - "invoice_supplier"
  - "supplier_location"
  - "period_required"
  - "terms"
  - "approver2"
  - "payment_terms"
  - "tariff_agreed_date"
  - "commercial_contract"
  - "commercial_contract_date"
  - "supplier_reminder"
  - "disputed_flag"
  - "budget_code"
  - "sent_to"
  - "warehouse_code"
  - "warehouse_supplier"
  - "delivery_to"
  - "maintenance_link"
  - "user_5"
  - "issued_by"
  - "prepare_direct"
  - "disputed_date"
  - "approved_flag"
  - "approved_date"
  - "sent_for_approval"
  - "sent_for_approval_date"
  - "disputed_comments"
  - "approved_comments"
  - "buyer_comments"
  - "supplier_name"
  - "accounting_flag"
  - "created_by_vessel"
  - "delivery_confirmation_date"
  - "acc_category_code"
  - "document_source"
  - "delivery_confirmation"
  - "vendor_location"
  - "acc_process_flag"
  - "forwarding_instructions"
  - "print_option"
  - "date_imported"
  - "spc_category_code"
  - "discount"
  - "exchange_rate_flag"
  - "previous_exchange_rate"
  - "order_date"
  - "accrual_reference"
  - "requisition_description"
  - "supplier_reminder_no"
  - "import_flag"
  - "quotation_comments"
  endpoint: "lo_delta_tables"
