version: 1
job:
  type: "processing"
  tags:
  - "epsdl_dim"
source:
  endpoint: "lo_delta_tables"
  properties:
    sql: "select \na.vessel_code as vessel_code \n,vessel_name\n,fleet_type_sub_code\n,fleet_type_sub\n,fleet_type_code\n,fleet_type\n,fleet_code\n,fleet\n,owning_entity\n,owning_entity_codes\n,ownership\n,vessel_type\n,vessel_group\n,dwt\n,built_year\n,sold_date\n,vessel_class\n,period\n,company_structure_in_danaos\n,qps_ownership\n,qct_ownership\n,managed_by_eps\n,ownership_type\n,built\n,date_built\n,useful_life\n,lwt\n,start_date\n,journal_start_date\n,journal_end_date\n,qct_start_date\n,addl_attribute1\n,addl_attribute2\n,addl_attribute3\n,last_updated_date\n,last_updated_by\n,eps_ownership\n,eps_uk_ownership\n,fleet_type_sort\n,vessel_ownership\n,region\n,a.integration_key as integration_key \n,sha2(a.vessel_code, 512) as vessel_id\n,null as w_x_custom\n,a.w_job_instance_id as w_job_instance_id \n,a.w_refresh_ts as w_refresh_ts\n,null as w_curr_rec_flg\n,a.w_source_system as w_data_src_id\n,a.w_location as w_location\n,a.w_batch_id as w_batch_id\n,'2020-07-24' as business_date\nfrom epsdlsrid.sri_vessel_hierarchy a\nleft join epsdlsrid.sri_vessel_master b on a.vessel_code = b.vessel_code\n/*where date_format(a.w_business_dt,'yyyy-MM-dd')='${business_date[0..9]}'*/"
  additional_columns:
  - name: "w_refresh_ts"
    value: "current_timestamp"
  - name: "business_date"
    value: "'${business_date}'"
  - name: "w_job_instance_id"
    value: "${job_instance_id}"
  - name: "w_batch_id"
    value: "${batch_id}"
  - name: "w_location"
    value: "'ALL'"
target:
  primary_key_columns:
  - "vessel_code"
  operation: "merge"
  properties:
    template: "default"
    table: "${p_epsdl_db}.dim_gl_vessel"
  merge_columns:
  - "vessel_name"
  - "fleet_type_sub_code"
  - "fleet_type_sub"
  - "fleet_type_code"
  - "fleet_type"
  - "fleet_code"
  - "fleet"
  - "owning_entity"
  - "owning_entity_codes"
  - "ownership"
  - "vessel_type"
  - "vessel_group"
  - "dwt"
  - "built_year"
  - "sold_date"
  - "vessel_class"
  - "period"
  - "company_structure_in_danaos"
  - "qps_ownership"
  - "qct_ownership"
  - "managed_by_eps"
  - "ownership_type"
  - "built"
  - "date_built"
  - "useful_life"
  - "lwt"
  - "start_date"
  - "journal_start_date"
  - "journal_end_date"
  - "qct_start_date"
  - "addl_attribute1"
  - "addl_attribute2"
  - "addl_attribute3"
  - "last_updated_date"
  - "last_updated_by"
  - "eps_ownership"
  - "eps_uk_ownership"
  - "fleet_type_sort"
  - "vessel_ownership"
  - "region"
  - "vessel_id"
  endpoint: "lo_delta_tables"
