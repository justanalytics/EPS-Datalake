version: 1
job:
  type: "processing"
  tags:
  - "epsdl_dim"
source:
  endpoint: "lo_delta_tables"
  properties:
    sql: "select \nSUPPLIER_CODE\n,STATUS\n,STATUS_DATE\n,STATUS_DUE\n,COUNTRY\n,CREATE_BY\n,CREATE_DATE\n,SUPPLIER_NAME\n,LAST_USED_DATE\n,SL_ENABLED\n,VERIFIED\n,STATUS_REMARKS\n,SCOPE\n,DEPARTMENT\n,APPROVED_BY\n,VERIFIED_BY \n,sha2(SUPPLIER_CODE,512) as supplier_id\n,integration_key\n,null as w_x_custom\n,w_job_instance_id\n,w_refresh_ts\n,null as w_curr_rec_flg\n,w_source_system as w_data_src_id\n,w_location\n,w_batch_id\n,'${business_date}' as business_date \nfrom ${p_epsdl_sri_db}.sri_supplier_registry\nwhere w_business_dt='${business_date}'"
  additional_columns:
  - name: "w_refresh_ts"
    value: "current_timestamp"
  - name: "business_date"
    value: "'${business_date}'"
  - name: "w_job_instance_id"
    value: "${job_instance_id}"
  - name: "w_batch_id"
    value: "${batch_id}"
  - name: "w_location"
    value: "'ALL'"
  - name: "w_source_system"
    value: "'NSLADMIN'"
target:
  primary_key_columns:
  - "integration_key"
  operation: "overwrite"
  properties:
    template: "default"
    table: "${p_epsdl_db}.dim_supplier"
  merge_columns:
  - "supplier_code"
  - "status"
  - "status_date"
  - "status_due"
  - "country"
  - "create_by"
  - "create_date"
  - "supplier_name"
  - "last_used_date"
  - "sl_enabled"
  - "verified"
  - "status_remarks"
  - "scope"
  - "department"
  - "approved_by"
  - "verified_by"
  endpoint: "lo_delta_tables"
