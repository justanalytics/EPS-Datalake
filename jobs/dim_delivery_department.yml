version: 1
job:
  type: "processing"
  tags:
  - "epsdl_dim"
source:
  endpoint: "lo_delta_tables"
  properties:
    sql: "select\ncode as department_code\n,dept_reference as department_reference\n,form_type\n,name as department_name\n,office_code\n,acc_code as account_code\n,acrl_code as accrual_account_code\n,${p_epsdl_sri_db}.sri_del_departments.integration_key\n,null as w_x_custom\n,${p_epsdl_sri_db}.sri_del_departments.w_job_instance_id\n,${p_epsdl_sri_db}.sri_del_departments.w_refresh_ts\n,null as w_curr_rec_flg\n,${p_epsdl_sri_db}.sri_del_departments.w_source_system as w_data_src_id\n,${p_epsdl_sri_db}.sri_del_departments.w_location\n,${p_epsdl_sri_db}.sri_del_departments.w_batch_id\n,'${business_date[0..9]}' as business_date\nfrom ${p_epsdl_sri_db}.sri_del_departments\nleft join ${p_epsdl_sri_db}.sri_dept_mapping on ${p_epsdl_sri_db}.sri_del_departments.code = ${p_epsdl_sri_db}.sri_dept_mapping.dept_code\nwhere ${p_epsdl_sri_db}.sri_del_departments.w_business_dt='${business_date[0..9]}'"
  additional_columns:
  - name: "w_refresh_ts"
    value: "current_timestamp"
  - name: "business_date"
    value: "'${business_date}'"
  - name: "w_job_instance_id"
    value: "${job_instance_id}"
  - name: "w_batch_id"
    value: "${batch_id}"
  - name: "w_location"
    value: "'ALL'"
  - name: "w_source_system"
    value: "'TANKPAC'"
target:
  primary_key_columns:
  - "integration_key"
  operation: "merge"
  properties:
    template: "default"
    table: "${p_epsdl_db}.dim_delivery_department"
  merge_columns:
  - "department_code"
  - "department_reference"
  - "form_type"
  - "department_name"
  - "office_code"
  - "account_code"
  - "accrual_account_code"
  endpoint: "lo_delta_tables"
