version: 1
job:
  type: "processing"
  tags:
  - "epsdl_fact"
source:
  endpoint: "lo_delta_tables"
  properties:
    sql: "select \ndocument_code\n,quotation_code\n,item_serial_no\n,supplier_code\n,quoted_qty\n,quoted_unit_group\n,quoted_unit_id\n,quoted_unit_factor\n,quoted_abbreviation\n,quoted_currency\n,quoted_rate\n,quoted_price\n,quoted_discount\n,item_availability\n,cheapest\n,protected\n,item_ref_code\n,item_system_code\n,item_subsystem_code\n,item_full_desc\n,item_short_desc\n,department\n,vessel_code\n,quoted_port\n,vat\n,additional_expenses\n,price_from\n,surcharges\n,evaluation_option\n,quotation_remarks\n,item_delivery_date\n,item_origin\n,integration_key\n,null as w_x_custom\n,w_job_instance_id\n,w_refresh_ts\n,null as w_curr_rec_flg\n,w_source_system as w_data_src_id\n,w_location\n,w_batch_id\n,'${business_date[0..9]}' as business_date\nfrom ${p_epsdl_sri_db}.sri_quoted_price\nwhere w_business_dt='${business_date[0..9]}'"
  additional_columns:
  - name: "w_refresh_ts"
    value: "current_timestamp"
  - name: "business_date"
    value: "'${business_date}'"
  - name: "w_job_instance_id"
    value: "${job_instance_id}"
  - name: "w_batch_id"
    value: "${batch_id}"
  - name: "w_location"
    value: "'ALL'"
  - name: "w_source_system"
    value: "'TANKPAC'"
target:
  primary_key_columns:
  - "integration_key"
  operation: "merge"
  properties:
    template: "default"
    table: "${p_epsdl_db}.fact_quoted_price"
  merge_columns:
  - "document_code"
  - "quotation_code"
  - "item_serial_no"
  - "supplier_code"
  - "quoted_qty"
  - "quoted_unit_group"
  - "quoted_unit_id"
  - "quoted_unit_factor"
  - "quoted_abbreviation"
  - "quoted_currency"
  - "quoted_rate"
  - "quoted_price"
  - "quoted_discount"
  - "item_availability"
  - "cheapest"
  - "protected"
  - "item_ref_code"
  - "item_system_code"
  - "item_subsystem_code"
  - "item_full_desc"
  - "item_short_desc"
  - "department"
  - "vessel_code"
  - "quoted_port"
  - "vat"
  - "additional_expenses"
  - "price_from"
  - "surcharges"
  - "evaluation_option"
  - "quotation_remarks"
  - "item_delivery_date"
  - "item_origin"
  endpoint: "lo_delta_tables"
