version: 1
job:
  type: "processing"
  tags:
  - "epsdl_dim"
source:
  endpoint: "lo_delta_tables"
  properties:
    sql: "select \nledger_card\n,account_group\n,acct_grouping_level4\n,acct_grouping_level3\n,acct_grouping_level2\n,acct_grouping_level1\n,null as company\n,null as service\n,null as department\n,null as future2\n,null as future1\n,null as inter_company\n,null as account\n,null as vessel\n,null as account_group_sort\n,null as format_key\n,null as signage\n,integration_key\n,null as w_x_custom\n,w_job_instance_id\n,w_refresh_ts\n,null as w_curr_rec_flg\n,w_source_system as w_data_src_id\n,w_location\n,w_batch_id\n,'${business_date[0..9]}' as business_date\nfrom ${p_epsdl_sri_db}.sri_gl_reporting_lines\nwhere w_business_dt='${business_date}'"
  additional_columns:
  - name: "w_refresh_ts"
    value: "current_timestamp"
  - name: "business_date"
    value: "'${business_date}'"
  - name: "w_job_instance_id"
    value: "${job_instance_id}"
  - name: "w_batch_id"
    value: "${batch_id}"
  - name: "w_location"
    value: "'ALL'"
  - name: "w_source_system"
    value: "'MANUAL'"
target:
  primary_key_columns:
  - "integration_key"
  operation: "merge"
  properties:
    template: "default"
    table: "${p_epsdl_db}.dim_reporting_lines"
  merge_columns:
  - "ledger_card"
  - "account_group"
  - "acct_grouping_level4"
  - "acct_grouping_level3"
  - "acct_grouping_level2"
  - "acct_grouping_level1"
  - "company"
  - "service"
  - "department"
  - "future2"
  - "future1"
  - "inter_company"
  - "account"
  - "vessel"
  - "account_group_sort"
  - "format_key"
  - "signage"
  endpoint: "lo_delta_tables"
