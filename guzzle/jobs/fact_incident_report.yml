version: 1
job:
  type: "processing"
  tags:
  - "epsdl_dim"
source:
  endpoint: "lo_delta_tables"
  properties:
    sql: "Select\nsri_incident_report.id\n,sri_incident_report.vessel_code\n,sri_incident_report.incident_place_id\n,sri_incident_report.incident_date\n,sri_incident_report.incident_time\n,sri_incident_report.incident_location_id\n,sri_incident_report.incident_risk_factor_id\n,sri_incident_report.incident_title\n,sri_incident_report.incident_type\n,sri_incident_report.incident_ref_no\n,sri_incident_report.primary_cat_id\n,sri_incident_report.sec_cat_id\n,sri_incident_report.minor_cat_id\n,sri_incident_report.vessel_movement\n,sri_incident_report.sea_condition\n,sri_incident_report.weather_condition\n,sri_incident_report.course_of_events\n,sri_incident_report.extent_of_damage\n,sri_incident_report.immediate_actions\n,sri_incident_report.immeditae_causes\n,sri_incident_report.underlying_causes\n,sri_incident_report.root_causes\n,sri_incident_report.lessons_learnt\n,sri_incident_report.master_sign\n,sri_incident_report.chief_engineer_sign\n,sri_incident_report.chief_officer_sign\n,sri_incident_report.assistant_engineer_sign\n,sri_incident_report.sub_cat_id\n,sri_incident_report.omodified_date\n,sri_incident_report.is_closed\n,sri_incident_report.vmodified_date\n,sri_incident_report.is_finalised\n,sri_incident_report.is_office_finalised\n,sri_incident_report.questionair_completed\n,sri_incident_report.master_staff_code\n,sri_incident_report.chief_engineer_staff_code\n,sri_incident_report.chief_officer_staff_code\n,sri_incident_report.assistant_engineer_staff_code\n,sri_incident_report.hasworkflow\n,sri_incident_report.identified_by\n,sri_incident_report.breach\n,dim_vessel.vessel_id\n,sri_incident_report.integration_key\n,null as w_x_custom\n,sri_incident_report.w_job_instance_id\n,sri_incident_report.w_refresh_ts\n,null as w_curr_rec_flg\n,sri_incident_report.w_source_system as w_data_src_id\n,sri_incident_report.w_location\n,sri_incident_report.w_batch_id\n,'${business_date}' as business_date \nfrom ${p_epsdl_sri_db}.sri_incident_report sri_incident_report\nleft join ${p_epsdl_db}.dim_gl_vessel dim_vessel on dim_vessel.vessel_code = sri_incident_report.vessel_code\nwhere sri_incident_report.w_business_dt='${business_date}'"
  additional_columns:
  - name: "w_refresh_ts"
    value: "current_timestamp"
  - name: "business_date"
    value: "'${business_date}'"
  - name: "w_job_instance_id"
    value: "${job_instance_id}"
  - name: "w_batch_id"
    value: "${batch_id}"
  - name: "w_location"
    value: "'ALL'"
  - name: "w_source_system"
    value: "'VLOG'"
target:
  primary_key_columns:
  - "integration_key"
  operation: "merge"
  properties:
    template: "default"
    table: "${p_epsdl_db}.fact_incident_report"
  merge_columns:
  - "id"
  - "vessel_code"
  - "incident_place_id"
  - "incident_date"
  - "incident_time"
  - "incident_location_id"
  - "incident_risk_factor_id"
  - "incident_title"
  - "incident_type"
  - "incident_ref_no"
  - "primary_cat_id"
  - "sec_cat_id"
  - "minor_cat_id"
  - "vessel_movement"
  - "sea_condition"
  - "weather_condition"
  - "course_of_events"
  - "extent_of_damage"
  - "immediate_actions"
  - "immeditae_causes"
  - "underlying_causes"
  - "root_causes"
  - "lessons_learnt"
  - "master_sign"
  - "chief_engineer_sign"
  - "chief_officer_sign"
  - "assistant_engineer_sign"
  - "sub_cat_id"
  - "omodified_date"
  - "is_closed"
  - "vmodified_date"
  - "is_finalised"
  - "is_office_finalised"
  - "questionair_completed"
  - "master_staff_code"
  - "chief_engineer_staff_code"
  - "chief_officer_staff_code"
  - "assistant_engineer_staff_code"
  - "hasworkflow"
  - "identified_by"
  - "breach"
  - "vessel_id"
  endpoint: "lo_delta_tables"
