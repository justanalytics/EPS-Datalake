version: 1
job:
  type: "processing"
  tags:
  - "epsdl_dim"
source:
  endpoint: "lo_delta_tables"
  properties:
    sql: "select\naccount_id,\nbusiness_date,\ndanaos_description_details,\ndanaos_description_main,\ndanaos_description_sub,\ndanaos_name,\ndescription,\nfinancial_category,\nfinancial_sub_category,\nintegration_key,\nledger_card,\noracle_natural_account,\nparent1_code,\nparent1_description,\nparent2_code,\nparent2_description,\nparent3_code,\nparent3_description,\nparent4_code,\nparent4_description,\nparent5_code,\nparent5_description,\nsource_system,\nw_batch_id,\nw_curr_rec_flg,\nw_data_src_id,\nw_job_instance_id,\nw_location,\nw_refresh_ts,\nw_x_custom\nfrom ${p_epsdl_db}.dim_gl_account_danaos where account_id <>'000000'\n\nunion\n\nselect\naccount_id,\nbusiness_date,\ndanaos_description_details,\ndanaos_description_main,\ndanaos_description_sub,\ndanaos_name,\ndescription,\nfinancial_category,\nfinancial_sub_category,\nintegration_key,\nledger_card,\noracle_natural_account,\nparent1_code,\nparent1_description,\nparent2_code,\nparent2_description,\nparent3_code,\nparent3_description,\nparent4_code,\nparent4_description,\nparent5_code,\nparent5_description,\nsource_system,\nw_batch_id,\nw_curr_rec_flg,\nw_data_src_id,\nw_job_instance_id,\nw_location,\nw_refresh_ts,\nw_x_custom\nfrom ${p_epsdl_db}.dim_gl_account_oracle_erp where account_id <>'0000000000'"
  additional_columns:
  - name: "w_refresh_ts"
    value: "current_timestamp"
  - name: "business_date"
    value: "'${business_date}'"
  - name: "w_job_instance_id"
    value: "${job_instance_id}"
  - name: "w_batch_id"
    value: "${batch_id}"
  - name: "w_location"
    value: "'ALL'"
  - name: "w_source_system"
    value: "'MANUAL'"
  incremental: false
target:
  operation: "overwrite"
  soft_delete: false
  properties:
    template: "default"
    table: "${p_epsdl_db}.dim_gl_account"
    post_sql:
    - "insert into ${p_epsdl_db}.dim_gl_account \nvalues\n(\n'000000',\n'000000',\nnull,\nnull,\nnull,\nnull,\nnull,\nnull,\nnull,\nnull,\nnull,\nnull,\nnull,\nnull,\nnull,\n'default',\nnull,\nnull,\nnull,\n'default',\n'000000',\n'000000',\nnull,\nnull,\n'DEFAULT',\nnull,\nnull,\nnull,\nnull,\nnull\n)"
  endpoint: "lo_delta_tables"
