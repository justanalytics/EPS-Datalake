version: 1
job:
  type: "processing"
  tags:
  - "epsdl_dim"
source:
  endpoint: "lo_delta_tables"
  properties:
    sql: "select sri_oracle_gl_segment.segment_code as child_value\n      ,sri_oracle_gl_segment.segment_desc as description\n      ,NULL as le\n      ,NULL as danaos_co_code\n      ,'ORACLE' as databasename\n      ,sha2(coalesce(sri_oracle_gl_segment.segment_code,'')||'0000'||'default'||'ORACLE', 512) as company_id\n      ,sri_oracle_gl_segment.integration_key\n      ,null as w_x_custom\n      ,sri_oracle_gl_segment.w_job_instance_id\n      ,sri_oracle_gl_segment.w_refresh_ts\n      ,null as w_curr_rec_flg\n      ,sri_oracle_gl_segment.w_source_system as w_data_src_id\n      ,sri_oracle_gl_segment.w_location\n      ,sri_oracle_gl_segment.w_batch_id\n      ,'${business_date}' as business_date\nfrom ${p_epsdl_sri_db}.sri_oracle_gl_segment sri_oracle_gl_segment\nwhere segment_lov_id='59001'\n  and sri_oracle_gl_segment.w_business_dt = '${business_date}'"
  additional_columns:
  - name: "w_refresh_ts"
    value: "current_timestamp"
  - name: "business_date"
    value: "'${business_date}'"
  - name: "w_job_instance_id"
    value: "${job_instance_id}"
  - name: "w_batch_id"
    value: "${batch_id}"
  - name: "w_location"
    value: "'ALL'"
  - name: "w_source_system"
    value: "'ORACLE'"
  incremental: false
target:
  primary_key_columns:
  - "child_value"
  - "w_data_src_id"
  operation: "merge"
  soft_delete: false
  properties:
    template: "default"
    table: "${p_epsdl_db}.dim_gl_company_oracle_erp"
    post_sql:
    - "delete from ${p_epsdl_db}.dim_gl_company where company_id is null"
  merge_columns:
  - "child_value"
  - "description"
  - "le"
  - "danaos_co_code"
  - "databasename"
  - "company_id"
  endpoint: "lo_delta_tables"
