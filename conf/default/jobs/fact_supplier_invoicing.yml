version: 1
job:
  type: "processing"
  tags:
  - "epsdl_fact"
source:
  endpoint: "lo_delta_tables"
  properties:
    sql: "select \ninvoice_no\n,order_supplier\n,order_code\n,delivery_codes\n,invoice_date\n,currency\n,invoice_amount\n,addn_packing_cost\n,reasons_for_variance\n,status\n,modified_by\n,modified_date\n,created_date\n,invoice_discount\n,addn_forwarding_cost\n,danaos_invoice_no\n,bank_id\n,sent_to_imos\n,integration_key\n,null as w_x_custom\n,w_job_instance_id\n,w_refresh_ts\n,null as w_curr_rec_flg\n,w_source_system as w_data_src_id\n,w_location\n,w_batch_id\n,'${business_date[0..9]}' as business_date\nfrom ${p_epsdl_sri_db}.sri_supplier_invoicing\nwhere w_business_dt='${business_date[0..9]}'"
  additional_columns:
  - name: "w_refresh_ts"
    value: "current_timestamp"
  - name: "business_date"
    value: "'${business_date}'"
  - name: "w_job_instance_id"
    value: "${job_instance_id}"
  - name: "w_batch_id"
    value: "${batch_id}"
  - name: "w_location"
    value: "'ALL'"
  - name: "w_source_system"
    value: "'TANKPAC'"
target:
  primary_key_columns:
  - "integration_key"
  operation: "merge"
  properties:
    template: "default"
    table: "${p_epsdl_db}.fact_supplier_invoicing"
  merge_columns:
  - "invoice_no"
  - "order_supplier"
  - "order_code"
  - "delivery_codes"
  - "invoice_date"
  - "currency"
  - "invoice_amount"
  - "addn_packing_cost"
  - "reasons_for_variance"
  - "status"
  - "modified_by"
  - "modified_date"
  - "created_date"
  - "invoice_discount"
  - "addn_forwarding_cost"
  - "danaos_invoice_no"
  - "bank_id"
  - "sent_to_imos"
  endpoint: "lo_delta_tables"
