version: 1
job:
  type: "processing"
  tags:
  - "epsdl_dim"
source:
  endpoint: "lo_delta_tables"
  properties:
    sql: "select\nagent\n,approver\n,create_date\n,delivery_activity_id\n,delivery_date\n,delivery_point_id\n,delivery_port\n,dlvr_qty\n,document_code\n,document_date\n,follow_up\n,index_value\n,item_count\n,order_agent\n,order_code\n,order_due_date\n,order_last_point\n,order_last_port\n,order_port\n,order_qty\n,order_ready_flag\n,order_status\n,po_description\n,po_remarks\n,project_id\n,report_value\n,short_name\n,status_code\n,supplier\n,total_items\n,total_poitems_cancelled\n,total_weight\n,vessel_code\n,integration_key\n,null as w_x_custom\n,w_job_instance_id\n,w_refresh_ts\n,null as w_curr_rec_flg\n,w_source_system as w_data_src_id\n,w_location\n,w_batch_id\n,'${business_date[0..9]}' as business_date\nfrom ${p_epsdl_sri_db}.sri_order_details\nwhere w_business_dt='${business_date[0..9]}'"
  additional_columns:
  - name: "w_refresh_ts"
    value: "current_timestamp"
  - name: "business_date"
    value: "'${business_date}'"
  - name: "w_job_instance_id"
    value: "${job_instance_id}"
  - name: "w_batch_id"
    value: "${batch_id}"
  - name: "w_location"
    value: "'ALL'"
  - name: "w_source_system"
    value: "'NSLADMIN'"
target:
  primary_key_columns:
  - "integration_key"
  operation: "merge"
  properties:
    template: "default"
    table: "${p_epsdl_db}.dim_order_details"
  merge_columns:
  - "agent"
  - "approver"
  - "create_date"
  - "delivery_activity_id"
  - "delivery_date"
  - "delivery_point_id"
  - "delivery_port"
  - "dlvr_qty"
  - "document_code"
  - "document_date"
  - "follow_up"
  - "index_value"
  - "item_count"
  - "order_agent"
  - "order_code"
  - "order_due_date"
  - "order_last_point"
  - "order_last_port"
  - "order_port"
  - "order_qty"
  - "order_ready_flag"
  - "order_status"
  - "po_description"
  - "po_remarks"
  - "project_id"
  - "report_value"
  - "short_name"
  - "status_code"
  - "supplier"
  - "total_items"
  - "total_poitems_cancelled"
  - "total_weight"
  - "vessel_code"
  endpoint: "lo_delta_tables"
