{
  "$schema": "http://json-schema.org/draft-04/schema#",
  "title": "Ingestion",
  "description": "Ingestion job configuration of guzzle framework",
  "type": "object",
  "properties": {
    "job": {
      "description": "Ingestion job configuration",
      "type": "object",
      "properties": {
        "type": {
          "type": "string",
          "enum": ["ingestion"]
        },
        "description": {
          "type": "string"
        },
        "tags": {
          "type": "array",
          "items": {
            "type": "string"
          }
        }
      },
      "required": ["type"],
      "additionalProperties": false
    },
    "import": {
      "type": "object",
      "properties": {
        "parent": {
          "type": "string"
        },
        "sections": {
          "type": "array",
          "items": {
            "type": "string",
            "enum": ["job", "source", "schema", "target", "reject"]
          }
        }
      },
      "required": ["parent"],
      "additionalProperties": false
    },
    "source": {
      "description": "Ingestion source configuration",
      "type": "object",
      "properties": {
        "endpoint": {
          "type": "string"
        },
        "incremental_load": {
          "type": "object",
          "properties": {
            "watermarking_key_columns": {
              "type": "array",
              "items": {
                "type": "string"
              }
            },
            "watermarking_columns": {
              "type": "array",
              "items": {
                "type": "object",
                "properties": {
                  "name": {
                    "type": "string"
                  },
                  "value": {
                    "type": "string"
                  },
                  "data_type": {
                    "type": "string"
                  }
                },
                "additionalProperties": false
              }
            },
            "filter": {
              "type": "string"
            }
          },
          "required": ["watermarking_columns"],
          "additionalProperties": false
        },
        "properties": {
          "type": "object",
          "properties": {
            "source_file_pattern": {
              "type": "string"
            },
            "charset": {
              "type": "string"
            },
            "format": {
              "type": "string",
              "enum": ["text", "delimited","json","xml","fixed","excel", "parquet", "orc", "avro"]
            },
            "partial_load": {
              "type": "boolean"
            },
            "table":{
              "type": "string"
            },
            "pre_sql": {
              "type": "array",
              "items": {
                "type": "string"
              }
            },
            "post_sql": {
              "type": "array",
              "items": {
                "type": "string"
              }
            },
            "filter":{
              "type": "string"
            },
            "query":{
              "type": "string"
            },
            "table_dependency": {
              "type": "array",
              "items": {
                "type": "string"
              }
            },
            "partition_column":{
              "type": "string"
            },
            "num_partitions":{
              "type": "number"
            },
            "include_columns": {
              "type": "array",
              "uniqueItems": true,
              "items": {
                "type": "string"
              }
            },
            "exclude_columns": {
              "type": "array",
              "uniqueItems": true,
              "items": {
                "type": "string"
              }
            },
            "uri": {
              "type": "string"
            },
            "http_method": {
              "type": "string",
              "enum": ["get", "post", "put", "delete"]
            },
            "parameters": {
              "type": "object"
            },
            "headers": {
              "type": "object"
            },
            "basic_authentication": {
              "type": "object",
              "properties": {
                "username": {
                  "type": ["string","number"]
                },
                "password": {
                  "type": ["string","number"]
                }
              }
            },
            "api_response_logical_endpoint": {
              "type": "string"
            },
            "processed_file_path": {
              "type": "string"
            },
            "format_properties": {
              "type": "object",
              "properties": {
                "column_delimiter": {
                  "type": "string"
                },
                "contains_header": {
                  "anyOf": [
                    { "type": "string", "pattern": "^\\s*\\$\\{.*\\}\\s*$" },
                    { "type": "boolean" }
                  ]
                },
                "clean_column_name": {
                  "anyOf": [
                    { "type": "string"},
                    { "type": "boolean" }
                  ]
                },
                "quote_delimiter": {
                  "type": "string"
                },
                "escape_char": {
                  "type": "string"
                },
                "columns": {
                  "type": "array",
                  "uniqueItems": true,
                  "items": {
                    "type": "object",
                    "patternProperties": {
                      "^*$": {
                        "type": ["string","integer"]
                      }
                    }
                  }
                },
                "multiline": {
                  "anyOf": [
                    { "type": "string", "pattern": "^\\s*\\$\\{.*\\}\\s*$" },
                    { "type": "boolean" }
                  ]
                },
                "date_format": {
                  "type": "string"
                },
                "timestamp_format": {
                  "type": "string"
                },
                "root_tag": {
                  "type": "string"
                },
                "row_tag": {
                  "type": "string"
                },
                "source_name_as_column": {
                  "type": "boolean"
                },
                "sheet_name": {
                  "type": "string"
                },
                "data_address": {
                  "type": "string"
                },
                "empty_as_null": {
                  "type": "boolean"
                },
                "infer_schema": {
                  "type": "boolean"
                },
                "add_color_columns": {
                  "type": "boolean"
                },
                "max_rows_in_memory": {
                  "type": ["string","integer"]
                },
                "workbook_password": {
                  "type": "string"
                },
                "merge_schema": {
                  "anyOf": [
                    { "type": "string", "pattern": "^\\s*\\$\\{.*\\}\\s*$" },
                    { "type": "boolean" }
                  ]
                },
                "format": {
                  "type": "string"
                },
                "parser": {
                  "type": "object",
                  "properties": {
                    "type": {
                      "type": "string",
                      "enum": ["regex", "grok"]
                    },
                    "pattern": {
                      "type": "string"
                    }
                  },
                  "additionalProperties": false
                }
              },
              "additionalProperties": false
            },
            "control_file": {
              "type": "object",
              "properties": {
                "extension": {
                  "type": "string"
                },
                "path": {
                  "type": "string"
                }
              },
              "additionalProperties": false
            },
            "view_id": {
              "type": ["string","integer"]
            },
            "metrics": {
              "type": "array",
              "uniqueItems": true,
              "items": {
                "type": "string"
              }
            },
            "dimensions": {
              "type": "array",
              "uniqueItems": true,
              "items": {
                "type": "string"
              }
            },
            "date_range": {
              "type": "object",
              "properties": {
                "start": {
                  "type": "string"
                },
                "end": {
                  "type": "string"
                }
              },
              "additionalProperties": false
            }
          },
          "additionalProperties": false
        },
        "column_mapping": {
          "type": "object",
          "patternProperties": {
            "^*$": {
              "type": "string"
            }
          }
        }
      },
      "required": ["endpoint", "properties"],
      "additionalProperties": false
    },
    "schema": {
      "description": "Ingestion source validation and derivation configuration",
      "type": "object",
      "properties": {
        "strict_schema_check": {
          "anyOf": [
            { "type": "string", "pattern": "^\\s*\\$\\{.*\\}\\s*$" },
            { "type": "boolean" }
          ]
        },
        "schema_derivation_strategy": {
          "type": "string",
          "enum": ["source", "schema", "target"]
        },
        "filter_sql": {
          "type": "string"
        },
        "discard": {
          "type": "boolean"
        },
        "columns": {
          "type": "array",
          "items": {
            "type": "object",
            "properties": {
              "name": {
                "type": "string"
              },
              "primary_key": {
                "type": "object",
                "properties": {
                  "value": {
                    "anyOf": [
                      { "type": "string", "pattern": "^\\s*\\$\\{.*\\}\\s*$" },
                      { "type": "boolean" }
                    ]
                  },
                  "discard": {
                    "type": "boolean"
                  }
                },
                "additionalProperties": false
              },
              "data_type": {
                "type": "object",
                "properties": {
                  "value": {
                    "type": "string"
                  },
                  "discard": {
                    "type": "boolean"
                  }
                },
                "additionalProperties": false
              },
              "nullable": {
                "type": "object",
                "properties": {
                  "value": {
                    "anyOf": [
                      { "type": "string", "pattern": "^\\s*\\$\\{.*\\}\\s*$" },
                      { "type": "boolean" }
                    ]
                  },
                  "discard": {
                    "type": "boolean"
                  }
                },
                "additionalProperties": false
              },
              "validate_sql": {
                "type": "object",
                "properties": {
                  "value": {
                    "type": "string"
                  },
                  "discard": {
                    "type": "boolean"
                  }
                },
                "additionalProperties": false
              },
              "transform_sql": {
                "type": "object",
                "properties": {
                  "value": {
                    "type": "string"
                  },
                  "discard": {
                    "type": "boolean"
                  }
                },
                "additionalProperties": false
              },
              "validate": {
                "type": "boolean"
              },
              "partition_column": {
                "type": "boolean"
              }
            },
            "additionalProperties": false
          },
          "additionalProperties": false
        }
      },
      "additionalProperties": false
    },
    "target": {
      "description": "Ingestion Target configuration",
      "type": "object",
      "properties": {
        "endpoint": {
          "type": "string"
        },
        "columns_to_be_loaded": {
          "type": "string",
          "enum": ["common","target"]
        },
        "operation": {
          "type": "string",
          "enum": ["append","overwrite"]
        },
        "truncate_partition_columns": {
          "type": "array",
          "items": {
            "type": "object",
            "properties": {
              "name": {
                "type": ["string", "number"]
              },
              "value": {
                "type": ["string", "number"]
              },
              "data_type":{
                "type": "string"
              }
            },
            "additionalProperties": false
          },
          "additionalProperties": false
        },
        "properties": {
          "type": "object",
          "properties": {
            "format": {
              "type": "string"
            },
            "charset": {
              "type": "string"
            },
            "table": {
              "type": "string"
            },
            "pre_sql": {
              "type": "array",
              "items": {
                "type": "string"
              }
            },
            "post_sql": {
              "type": "array",
              "items": {
                "type": "string"
              }
            },
            "auto_create_table": {
              "anyOf": [
                { "type": "string", "pattern": "^\\s*\\$\\{.*\\}\\s*$" },
                { "type": "boolean" }
              ]
            },
            "path": {
              "type": "string"
            },
            "table_dependency": {
              "type": "array",
              "items": {
                "type": "string"
              }
            },
            "preserve_hierarchy": {
              "anyOf": [
                { "type": "string", "pattern": "^\\s*\\$\\{.*\\}\\s*$" },
                { "type": "boolean" }
              ]
            },
            "format_properties": {
              "type": "object",
              "properties": {
                "column_delimiter": {
                  "type": "string"
                },
                "quote_delimiter": {
                  "type": "string"
                },
                "contains_header": {
                  "anyOf": [
                    { "type": "string", "pattern": "^\\s*\\$\\{.*\\}\\s*$" },
                    { "type": "boolean" }
                  ]
                },
                "multiline": {
                  "anyOf": [
                    { "type": "string", "pattern": "^\\s*\\$\\{.*\\}\\s*$" },
                    { "type": "boolean" }
                  ]
                },
                "merge_file": {
                  "anyOf": [
                    { "type": "string", "pattern": "^\\s*\\$\\{.*\\}\\s*$" },
                    { "type": "boolean" }
                  ]
                },
                "root_tag": {
                  "type": "string"
                },
                "row_tag": {
                  "type": "string"
                },
                "sheet_name": {
                  "type": "string"
                },
                "data_address": {
                  "type": "string"
                },
                "workbook_password": {
                  "type": "string"
                },
                "date_format": {
                  "type": "string"
                },
                "timestamp_format": {
                  "type": "string"
                },
                "compression": {
                  "type": "string"
                },
                "format": {
                  "type": "string"
                },
                "bulkCopyEnable": {
                  "anyOf": [
                    {"type": "string"},
                    {"type": "boolean"}
                  ]
                },
                "bulkCopyBatchSize": {
                  "anyOf": [
                    {"type": "string"},
                    {"type": "number"}
                  ]
                },
                "bulkCopyTableLock": {
                  "anyOf": [
                    {"type": "string"},
                    {"type": "boolean"}
                  ]
                },
                "bulkCopyTimeout": {
                  "anyOf": [
                    {"type": "string"},
                    {"type": "number"}
                  ]
                },
                "write_semantics": {
                  "type": "string",
                  "enum": ["polybase"]
                },
                "max_str_length": {
                  "anyOf": [
                    {"type": "string"},
                    {"type": "number"}
                  ]
                }
              },
              "additionalProperties": false
            },
            "control_file": {
              "type": "object",
              "properties": {
                "extension": {
                  "type": "string"
                }
              },
              "additionalProperties": false
            }
          },
          "additionalProperties": false
        }
      },
      "required": ["endpoint","properties"],
      "additionalProperties": false
    },
    "reject": {
      "description": "Ingestion Reject Records configuration",
      "type": "object",
      "properties": {
        "endpoint": {
          "type": "string"
        },
        "columns_to_be_loaded": {
          "type": "string",
          "enum": ["target","common","source"]
        },
        "failure_threshold": {
          "type": "number",
          "maximum": 100,
          "minimum": 0
        },
        "properties": {
          "type": "object",
          "properties": {
            "charset": {
              "type": "string"
            },
            "table": {
              "type": "string"
            },
            "auto_create_table": {
              "anyOf": [
                { "type": "string", "pattern": "^\\s*\\$\\{.*\\}\\s*$" },
                { "type": "boolean" }
              ]
            },
            "pre_sql": {
              "type": "array",
              "items": {
                "type": "string"
              }
            },
            "post_sql": {
              "type": "array",
              "items": {
                "type": "string"
              }
            },
            "format": {
              "type": "string"
            },
            "path": {
              "type": "string"
            },
            "table_dependency": {
              "type": "array",
              "items": {
                "type": "string"
              }
            },
            "preserve_hierarchy": {
              "anyOf": [
                { "type": "string", "pattern": "^\\s*\\$\\{.*\\}\\s*$" },
                { "type": "boolean" }
              ]
            },
            "format_properties": {
              "type": "object",
              "properties": {
                "column_delimiter": {
                  "type": "string"
                },
                "quote_delimiter": {
                  "type": "string"
                },
                "contains_header": {
                  "anyOf": [
                    { "type": "string", "pattern": "^\\s*\\$\\{.*\\}\\s*$" },
                    { "type": "boolean" }
                  ]
                },
                "merge_file": {
                  "anyOf": [
                    { "type": "string", "pattern": "^\\s*\\$\\{.*\\}\\s*$" },
                    { "type": "boolean" }
                  ]
                },
                "root_tag": {
                  "type": "string"
                },
                "row_tag": {
                  "type": "string"
                },
                "sheet_name": {
                  "type": "string"
                },
                "data_address": {
                  "type": "string"
                },
                "workbook_password": {
                  "type": "string"
                },
                "date_format": {
                  "type": "string"
                },
                "timestamp_format": {
                  "type": "string"
                },
                "compression": {
                  "type": "string"
                },
                "format": {
                  "type": "string"
                },
                "bulkCopyEnable": {
                  "anyOf": [
                    {"type": "string"},
                    {"type": "boolean"}
                  ]
                },
                "bulkCopyBatchSize": {
                  "anyOf": [
                    {"type": "string"},
                    {"type": "number"}
                  ]
                },
                "bulkCopyTableLock": {
                  "anyOf": [
                    {"type": "string"},
                    {"type": "boolean"}
                  ]
                },
                "bulkCopyTimeout": {
                  "anyOf": [
                    {"type": "string"},
                    {"type": "number"}
                  ]
                },
                "write_semantics": {
                  "type": "string",
                  "enum": ["polybase"]
                },
                "max_str_length": {
                  "anyOf": [
                    {"type": "string"},
                    {"type": "number"}
                  ]
                }
              },
              "additionalProperties": false
            },
            "control_file": {
              "type": "object",
              "properties": {
                "extension": {
                  "type": "string"
                }
              },
              "additionalProperties": false
            }
          },
          "additionalProperties": false
        }
      },
      "required": ["endpoint","properties"],
      "additionalProperties": false
    },
    "version": {
      "type": "integer"
    }
  },
  "required": ["job", "source", "target"],
  "additionalProperties": false
}
